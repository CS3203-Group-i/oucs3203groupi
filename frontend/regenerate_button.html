<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Regenerate Schedule</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 6px;
    }
    .input-group {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h2>Fall 2025 Regenerate Schedule</h2>

  <div id="courseInputs">
    <div class="input-group">
      <input type="text" class="courseInput" placeholder="e.g. MATH 3113">
    </div>
  </div>
  <button onclick="addCourseInput()">‚ûï Add Another Course</button>
  <button onclick="regenerateSchedule()">üîÅ Regenerate Schedule</button>

  <table id="scheduleTable" style="margin-top:20px; display:none;">
    <thead>
      <tr>
        <th>CRN</th><th>Subject</th><th>Course</th><th>Section</th><th>Title</th><th>Instructor</th><th>Dates</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function addCourseInput() {
      const inputContainer = document.getElementById("courseInputs");
      const currentInputs = inputContainer.querySelectorAll(".courseInput").length;
      if (currentInputs >= 10) {
        alert("You can only enter up to 10 courses.");
        return;
      }

      const newDiv = document.createElement("div");
      newDiv.className = "input-group";
      newDiv.innerHTML = `<input type="text" class="courseInput" placeholder="e.g. CS 2114">`;
      inputContainer.appendChild(newDiv);
    }

    async function regenerateSchedule() {
      const inputs = Array.from(document.querySelectorAll(".courseInput"));
      const courseQueries = inputs.map(input => input.value.trim()).filter(Boolean);
      if (courseQueries.length === 0 || courseQueries.length > 10) {
        alert("Please enter between 1 and 10 course queries.");
        return;
      }

      const res = await fetch("../backend/data_extraction/data/extracted_classnav.txt");
      const text = await res.text();
      const lines = text.split("\n");

      const matches = {};
      for (const line of lines) {
        for (const query of courseQueries) {
          const parts = query.trim().split(/\s+/);
          const course = parts.pop();              // last part = course number
          const subject = parts.join(" ");         // the rest = subject code

          if (!subject || !course) continue;
          const regex = new RegExp(`\\|\\s*${subject.toUpperCase()}\\s*\\|\\s*${course}\\s*\\|`);
          if (regex.test(line)) {
            if (!matches[query]) matches[query] = [];
            matches[query].push(line);
          }
        }
      }

      const tbody = document.querySelector("#scheduleTable tbody");
      tbody.innerHTML = "";
      let anyMatch = false;

      for (const query of courseQueries) {
        const options = matches[query];
        if (options && options.length > 0) {
          anyMatch = true;
          const pick = options[Math.floor(Math.random() * options.length)];
          const parts = pick.split("|").map(p => p.trim());
          if (parts.length >= 7) {
            const row = `<tr>${parts.slice(0, 7).map(p => `<td>${p}</td>`).join("")}</tr>`;
            tbody.innerHTML += row;
          }
        }
      }

      document.getElementById("scheduleTable").style.display = anyMatch ? "table" : "none";
      if (!anyMatch) alert("No matches found for the given courses.");
    }
  </script>
</body>
</html>


